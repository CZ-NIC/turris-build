From d0b41796383e312fb98d5f9d1a5bcb9f3ad8ea82 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Karel=20Ko=C4=8D=C3=AD?= <karel.koci@nic.cz>
Date: Mon, 11 Mar 2019 16:25:30 +0100
Subject: [PATCH] Add kernel configuration options for Turris 1.x
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This is hacky approach and we should instead add these options to board
specific configuration.

Signed-off-by: Karel Kočí <karel.koci@nic.cz>
---
 target/linux/mpc85xx/config-4.19 | 73 ++++++++++++++++++++++++++++----
 1 file changed, 65 insertions(+), 8 deletions(-)

diff --git a/target/linux/mpc85xx/config-4.19 b/target/linux/mpc85xx/config-4.19
index df4d741..828267d 100644
--- a/target/linux/mpc85xx/config-4.19
+++ b/target/linux/mpc85xx/config-4.19
@@ -41,6 +41,15 @@ CONFIG_BOOKE_WDT=y
 CONFIG_BOUNCE=y
 # CONFIG_BSC9131_RDB is not set
 # CONFIG_BSC9132_QDS is not set
+CONFIG_BTRFS_FS=y
+CONFIG_VFAT_FS=y
+CONFIG_FAT_DEFAULT_CODEPAGE=437
+CONFIG_FAT_DEFAULT_IOCHARSET="iso8859-1"
+CONFIG_NLS_CODEPAGE_437=y
+CONFIG_NLS_ISO8859_1=y
+# CONFIG_BTRFS_FS_CHECK_INTEGRITY is not set
+CONFIG_BTRFS_FS_POSIX_ACL=y
+CONFIG_BUILD_BIN2C=y
 # CONFIG_C293_PCIE is not set
 CONFIG_CLONE_BACKWARDS=y
 CONFIG_CLZ_TAB=y
@@ -58,6 +67,7 @@ CONFIG_CRYPTO_AKCIPHER2=y
 CONFIG_CRYPTO_AUTHENC=y
 CONFIG_CRYPTO_HASH=y
 CONFIG_CRYPTO_HASH2=y
+CONFIG_CRYPTO_LZO=y
 CONFIG_CRYPTO_HW=y
 CONFIG_CRYPTO_MANAGER=y
 CONFIG_CRYPTO_MANAGER2=y
@@ -71,6 +81,7 @@ CONFIG_CRYPTO_RSA=y
 # CONFIG_CRYPTO_SHA1_PPC_SPE is not set
 # CONFIG_CRYPTO_SHA256_PPC_SPE is not set
 CONFIG_CRYPTO_WORKQUEUE=y
+CONFIG_CRYPTO_XZ=y
 CONFIG_DEBUG_BUGVERBOSE=y
 CONFIG_DNOTIFY=y
 CONFIG_DTC=y
@@ -102,7 +113,7 @@ CONFIG_GENERIC_CLOCKEVENTS=y
 CONFIG_GENERIC_CMOS_UPDATE=y
 CONFIG_GENERIC_CPU=y
 CONFIG_GENERIC_CPU_AUTOPROBE=y
-CONFIG_GENERIC_CPU_VULNERABILITIES=y
+CONFIG_GENERIC_IO=y
 CONFIG_GENERIC_IRQ_SHOW=y
 CONFIG_GENERIC_IRQ_SHOW_LEVEL=y
 CONFIG_GENERIC_ISA_DMA=y
@@ -165,12 +176,17 @@ CONFIG_I2C_BOARDINFO=y
 CONFIG_I2C_MPC=y
 CONFIG_ILLEGAL_POINTER_VALUE=0
 CONFIG_INITRAMFS_SOURCE=""
+CONFIG_IOMMU_HELPER=y
 CONFIG_IRQCHIP=y
 CONFIG_IRQ_DOMAIN=y
 CONFIG_IRQ_FORCED_THREADING=y
 CONFIG_IRQ_WORK=y
 CONFIG_ISA_DMA_API=y
 CONFIG_KERNEL_GZIP=y
+CONFIG_JFFS2_FS_POSIX_ACL=y
+CONFIG_JFFS2_LZO=y
+CONFIG_JFFS2_RUBIN=y
+CONFIG_JFFS2_ZLIB=y
 CONFIG_KERNEL_START=0xc0000000
 # CONFIG_KSI8560 is not set
 CONFIG_LEGACY_PTYS=y
@@ -180,46 +196,77 @@ CONFIG_LOCK_DEBUGGING_SUPPORT=y
 CONFIG_LOWMEM_CAM_NUM=3
 CONFIG_LOWMEM_SIZE=0x30000000
 CONFIG_LXT_PHY=y
-# CONFIG_MATH_EMULATION is not set
+CONFIG_LZO_COMPRESS=y
+CONFIG_LZO_DECOMPRESS=y
+CONFIG_MATH_EMULATION=y
+# CONFIG_MATH_EMULATION_FULL is not set
+CONFIG_MATH_EMULATION_HW_UNIMPLEMENTED=y
+CONFIG_MDIO_BOARDINFO=y
 CONFIG_MDIO_BUS=y
 CONFIG_MDIO_DEVICE=y
 CONFIG_MEMFD_CREATE=y
 CONFIG_MIGRATION=y
+CONFIG_MMC=y
+CONFIG_MMC_BLOCK=y
+CONFIG_MMC_SDHCI=y
+CONFIG_MMC_SDHCI_IO_ACCESSORS=y
+CONFIG_MMC_SDHCI_OF_ESDHC=y
+# CONFIG_MMC_SDHCI_PCI is not set
+CONFIG_MMC_SDHCI_PLTFM=y
+# CONFIG_MMC_TIFM_SD is not set
+# CONFIG_MMC_WBSD is not set
+# CONFIG_MMIO_NVRAM is not set
 CONFIG_MODULES_USE_ELF_RELA=y
 # CONFIG_MPC8536_DS is not set
 # CONFIG_MPC8540_ADS is not set
 # CONFIG_MPC8560_ADS is not set
-# CONFIG_MPC85xx_CDS is not set
+CONFIG_MPC85xx_CDS=y
 # CONFIG_MPC85xx_DS is not set
-# CONFIG_MPC85xx_MDS is not set
-# CONFIG_MPC85xx_RDB is not set
+CONFIG_MPC85xx_MDS=y
+CONFIG_MPC85xx_RDB=y
 CONFIG_MPIC=y
 # CONFIG_MPIC_MSGR is not set
 CONFIG_MPIC_TIMER=y
 CONFIG_MPILIB=y
-# CONFIG_MTD_CFI is not set
+# CONFIG_MTD_CFI_NOSWAP is not set
+CONFIG_MTD_CFI_STAA=y
+CONFIG_MTD_JEDECPROBE=y
 CONFIG_MTD_M25P80=y
+CONFIG_MTD_RAM=y
+CONFIG_MTD_ROM=y
 CONFIG_MTD_SPI_NOR=y
+CONFIG_MTD_UBI=y
+CONFIG_MTD_UBI_BEB_LIMIT=20
+# CONFIG_MTD_UBI_BLOCK is not set
+# CONFIG_MTD_UBI_FASTMAP is not set
+# CONFIG_MTD_UBI_GLUEBI is not set
+CONFIG_MTD_UBI_WL_THRESHOLD=4096
+CONFIG_MUTEX_SPIN_ON_OWNER=y
 # CONFIG_MVME2500 is not set
 CONFIG_NEED_PER_CPU_KM=y
 CONFIG_NEED_SG_DMA_LENGTH=y
 CONFIG_NLS=y
 CONFIG_NO_BOOTMEM=y
+CONFIG_NR_CPUS=4
 CONFIG_NR_IRQS=512
 CONFIG_NVMEM=y
 CONFIG_OF=y
 CONFIG_OF_ADDRESS=y
+CONFIG_OF_ADDRESS_PCI=y
 CONFIG_OF_EARLY_FLATTREE=y
 CONFIG_OF_FLATTREE=y
 CONFIG_OF_GPIO=y
 CONFIG_OF_IRQ=y
 CONFIG_OF_KOBJ=y
 CONFIG_OF_MDIO=y
+CONFIG_OF_MTD=y
 CONFIG_OF_NET=y
+CONFIG_OF_PCI=y
+CONFIG_OF_PCI_IRQ=y
 CONFIG_OF_RESERVED_MEM=y
 CONFIG_OLD_SIGACTION=y
 CONFIG_OLD_SIGSUSPEND=y
-# CONFIG_P1010_RDB is not set
+CONFIG_P1010_RDB=y
 # CONFIG_P1022_DS is not set
 # CONFIG_P1022_RDK is not set
 # CONFIG_P1023_RDB is not set
@@ -258,7 +305,7 @@ CONFIG_PPC_DOORBELL=y
 # CONFIG_PPC_EARLY_DEBUG is not set
 CONFIG_PPC_FSL_BOOK3E=y
 CONFIG_PPC_INDIRECT_PCI=y
-# CONFIG_PPC_IRQ_SOFT_MASK_DEBUG is not set
+CONFIG_PPC_LIB_RHEAP=y
 CONFIG_PPC_MMU_NOHASH=y
 CONFIG_PPC_PCI_CHOICE=y
 # CONFIG_PPC_PTDUMP is not set
@@ -292,12 +339,14 @@ CONFIG_SPE=y
 CONFIG_SPE_POSSIBLE=y
 CONFIG_SPI=y
 CONFIG_SPI_FSL_ESPI=y
+CONFIG_SPI_FSL_LIB=y
 CONFIG_SPI_MASTER=y
 CONFIG_SPI_MEM=y
 CONFIG_SRCU=y
 # CONFIG_STRIP_ASM_SYMS is not set
 # CONFIG_STX_GP3 is not set
 CONFIG_SWCONFIG=y
+CONFIG_SWIOTLB=y
 CONFIG_SWPHY=y
 CONFIG_SYSCTL_EXCEPTION_TRACE=y
 CONFIG_TASK_SIZE=0xc0000000
@@ -310,7 +359,13 @@ CONFIG_TINY_SRCU=y
 # CONFIG_TQM8548 is not set
 # CONFIG_TQM8555 is not set
 # CONFIG_TQM8560 is not set
+CONFIG_TREE_RCU=y
 # CONFIG_TWR_P102x is not set
+CONFIG_UBIFS_FS=y
+CONFIG_UBIFS_FS_ADVANCED_COMPR=y
+CONFIG_UBIFS_FS_LZO=y
+CONFIG_UBIFS_FS_XZ=y
+CONFIG_UBIFS_FS_ZLIB=y
 CONFIG_UCC=y
 CONFIG_UCC_FAST=y
 CONFIG_UCC_GETH=y
@@ -322,5 +377,7 @@ CONFIG_VM_EVENT_COUNTERS=y
 CONFIG_WATCHDOG_CORE=y
 # CONFIG_XES_MPC85xx is not set
 # CONFIG_XPS_USB_HCD_XILINX is not set
+CONFIG_XOR_BLOCKS=y
+CONFIG_XPS=y
 CONFIG_XZ_DEC_BCJ=y
 CONFIG_XZ_DEC_POWERPC=y
-- 
2.22.1

